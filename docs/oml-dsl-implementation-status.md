# OML DSL 改进建议实现状态分析

基于对代码的分析，以下是改进建议文档中各项提案的实现状态：

## 第一阶段改进建议（建议采纳）

### ✅ 1. 明确并保留 `read`/`take` 的差异；删除 `crate`
- **状态**：已实现
- **分析**：
  - `read` 和 `take` 的语义差异在代码中得到保留
  - `read` 为非破坏性读取，`take` 为破坏性读取
  - `crate` 关键字虽然解析层保留兼容，但已不在文档中曝光

### ✅ 2. 收敛参数键，避免 `in` 歧义
- **状态**：已实现
- **分析**：
  - 在 `collect_prm.rs` 中支持 `keys:` 作为 `in:` 的同义词
  - 测试用例显示：`collect take(keys: [a,b,c*])` 和 `collect take(in: [a,b,c*])` 都被支持
  - 文档主推 `keys:`，解析兼容 `in:`

### ⚠️ 4. 规范 match 分支分隔
- **状态**：部分实现
- **分析**：
  - 分号 `;` 和逗号 `,` 都被支持作为分支分隔符
  - 但还没有强制使用分号，或给出优先级建议

### ❌ 5. 强化错误上下文
- **状态**：未实现
- **分析**：
  - 代码中没有找到增强的错误提示实现
  - 没有提供 "Expected: ..." 提示和可用枚举值列表
  - 错误信息仍然比较基础

## 第二阶段改进建议（可选项）

### ❌ 1. 管道语法去掉前缀 `pipe`
- **状态**：未实现
- **分析**：
  - 所有管道操作仍然需要 `pipe` 关键字
  - 没有看到支持 `read(x) | to_json` 这种语法的解析逻辑
  - 必须写成 `pipe read(x) | to_json`

### ✅ 2. `map` 增加直观别名
- **状态**：已实现
- **分析**：
  - 已支持 `object { ... }` 语法
  - 在 `map_prm.rs` 中，`object` 关键字被解析为 `MapOperation`
  - 与 `map` 语义相同，文档可以主推 `object`

### ❌ 4. 隐私段短名
- **状态**：未实现
- **分析**：
  - 没有看到隐私相关的短名实现
  - 如 `privacy_ip` -> `ip` 的简化

### ❌ 6. pipe 函数家族命名一致性
- **状态**：未实现
- **分析**：
  - 仍然使用 `arr_get`、`obj_get`、`path_get`、`url_get` 等原名
  - 没有看到 `nth`、`get` 等别名实现

### ❌ 7. 内置时间函数别名
- **状态**：未实现
- **分析**：
  - 只看到 `Time::now_*` 的用法
  - 没有 `now.date()`、`now.time()` 等更自然的写法

### ❌ 8. header `rule` 更直观
- **状态**：未实现
- **分析**：
  - 没有看到 `rules:`、`use:` 或 `import:` 的实现

## 已实现的功能总结

1. **`keys:` 参数支持** - 实现了建议的参数键统一
2. **`object` 语法** - 提供了 `map` 的直观别名
3. **`read`/`take` 语义保留** - 明确了非破坏性/破坏性读取的差异

## 未实现的重要功能

1. **管道语法简化** - 仍然需要 `pipe` 关键字
2. **增强的错误提示** - 缺少详细的错误上下文和期望值提示
3. **函数命名优化** - pipe 函数仍然使用冗长的名称
4. **时间函数简化** - 没有更自然的时间函数写法
5. **隐私段简化** - 没有实现隐私字段的短名

## 建议

1. **优先实现管道语法简化** - 这是最影响可读性的改进
2. **添加增强的错误提示** - 这对用户体验非常重要
3. **逐步添加函数别名** - 可以先添加别名，保持向后兼容
4. **考虑实现 `now.*` 时间函数** - 提供更直观的 API